# kintone 発注管理システム 運用フロー

**対象**: 発注担当者、経理担当者、管理者  
**バージョン**: 1.0  
**最終更新**: 2026年2月14日

---

## 📋 目次

1. [日次運用フロー](#1-日次運用フロー)
2. [月次運用フロー](#2-月次運用フロー)
3. [マスタデータ管理](#3-マスタデータ管理)
4. [ERP連携フロー](#4-erp連携フロー)
5. [エラー対応フロー](#5-エラー対応フロー)
6. [データメンテナンス](#6-データメンテナンス)

---

## 1. 日次運用フロー

### 1.1 発注業務の基本フロー

```
┌──────────────────────────────────────────────┐
│            発注業務デイリーフロー            │
└──────────────────────────────────────────────┘

午前
├─ 09:00 - 10:00  見積確認・選定
│   ├─ 見積マスタの確認
│   ├─ 価格・納期の比較
│   └─ 発注先の決定
│
├─ 10:00 - 11:30  発注書作成
│   ├─ カスタムビュー「発注登録画面」を開く
│   ├─ 基本情報入力
│   ├─ 見積から明細取込
│   ├─ 案件配分設定
│   └─ 内容確認・登録
│
└─ 11:30 - 12:00  上長確認依頼
    └─ ステータス「承認待ち」で保存

午後
├─ 13:00 - 14:00  承認処理 (上長)
│   ├─ 発注内容の確認
│   ├─ 案件配分の確認
│   └─ ステータス「発注済み」に変更
│
├─ 14:00 - 15:00  発注書送付
│   ├─ PDF出力 (今後実装)
│   └─ メール送付
│
└─ 15:00 - 17:00  データ確認
    ├─ ERP登録用テーブルの確認
    ├─ CSV出力 (今後実装)
    └─ ERPシステムへの取込
```

### 1.2 発注書作成の詳細フロー

#### ステップ1: 事前準備 (5分)

**チェックリスト**:
- [ ] 発注先がマスタに登録されているか
- [ ] アイテムがマスタに登録されているか
- [ ] 見積データが登録されているか
- [ ] 案件番号が確定しているか

**未登録の場合**:
1. 各マスタアプリで新規登録
2. 登録完了を確認
3. 発注書作成に進む

#### ステップ2: 基本情報入力 (5分)

1. **発注元選択**
   - ドロップダウンから選択
   - 住所・代表者が自動入力されることを確認

2. **発注先選択**
   - 🔍 検索ボタンをクリック
   - キーワード入力 (会社名・コード)
   - 検索結果から選択
   - 発注先情報が自動入力されることを確認

3. **日付・件名入力**
   - 発注日: 当日または指定日
   - 件名: 分かりやすい名称 (例: 2026年2月部品発注)
   - 納期: 希望納期を入力

4. **通貨・税率選択**
   - 通貨: JPY (円建て) / USD / EUR
   - 外貨の場合は為替レート入力
   - 税コード: 消費税10% / 軽減税率8%

#### ステップ3: 明細入力 (10-20分)

**方法A: 見積から取込 (推奨)**

1. 「📋 見積参照」ボタンをクリック
2. 見積を検索・選択
3. 「この見積を取込」ボタンをクリック
4. 明細が自動入力されることを確認
5. 必要に応じて数量・単価を調整

**方法B: 手動入力**

1. 「+ 明細行追加」ボタンをクリック
2. アイテムコード: 🔍 検索ボタンで選択
3. アイテム名: 自動入力 (修正可)
4. 詳細項目: 仕様・追加情報を入力
5. 単価: 数値入力
6. 数量: 数値入力
7. 金額: 自動計算されることを確認
8. 必要に応じて行を追加

#### ステップ4: 案件配分 (5-10分)

**案件配分が必要な場合のみ**

1. 各明細行の「+ 案件配分」ボタンをクリック
2. 案件番号と配分数量を入力
   - 手動入力
   - または Excel 形式で貼り付け
3. 配分合計と明細数量が一致するか確認
4. OKボタンで保存

**Excel 貼り付け例**:

```
P001	6
P002	4
```

#### ステップ5: 最終確認 (3分)

**チェックリスト**:
- [ ] 発注元・発注先が正しいか
- [ ] 発注日・納期が正しいか
- [ ] 明細の数量・単価が正しいか
- [ ] 案件配分が正しいか (該当する場合)
- [ ] 金額合計が正しいか
- [ ] 消費税が正しく計算されているか

#### ステップ6: 登録 (1分)

1. **下書き保存** (後で編集する場合)
   - 💾 下書き保存ボタンをクリック
   - ステータス「下書き」で保存
   - 後から編集可能

2. **本登録** (確定する場合)
   - ✅ 登録ボタンをクリック
   - 確認ダイアログで内容確認
   - OKで登録
   - ステータス「承認待ち」で保存

---

## 2. 月次運用フロー

### 2.1 月初の作業 (月初3営業日)

#### 1. 前月実績の確認 (30分)

**レポート作成**:

1. 発注管理アプリを開く
2. 「その他の操作」→「レポート」
3. 以下のレポートを作成:
   - 発注先別集計
   - 案件別集計
   - ステータス別集計

**確認項目**:
- [ ] 未承認の発注書がないか
- [ ] 完了していない発注がないか
- [ ] ERPテーブルが正しく生成されているか

#### 2. マスタデータの整備 (1時間)

**発注先マスタ**:
- 新規取引先の追加
- 住所・連絡先の更新
- 取引停止先の無効化

**アイテムマスタ**:
- 新商品の追加
- 単価の見直し
- 廃番商品の整理

**基本情報マスタ**:
- 税率の確認 (税制改正時)
- 為替レートの更新 (外貨取引がある場合)

#### 3. データバックアップ (30分)

**アプリ設定のバックアップ**:
1. 「アプリ設定」→「アプリを読み込む」
2. 「現在のアプリの設定をファイルに書き出す」
3. JSONファイルをダウンロード
4. 共有フォルダに保存

**レコードデータのバックアップ**:
1. 発注管理アプリの一覧画面
2. 「その他の操作」→「ファイルへ書き出す」
3. CSV形式でエクスポート
4. 共有フォルダに保存

### 2.2 月末の作業 (月末最終営業日)

#### 1. 当月実績の集計 (1時間)

**CSV出力**:
1. 発注管理アプリを開く
2. フィルタ: 発注日が当月
3. 「その他の操作」→「ファイルへ書き出す」
4. CSV形式でエクスポート

**集計内容**:
- 発注件数
- 発注金額合計
- 発注先別金額
- 案件別金額

#### 2. ERP連携データの確認 (30分)

**ERP登録用テーブルの確認**:
1. 各発注書の詳細画面を開く
2. ERPテーブルが正しく生成されているか確認
3. 案件配分が正しく展開されているか確認

**不整合があった場合**:
- 発注書を修正 (可能な場合)
- または手動でERPに補正データを登録

#### 3. 翌月の準備 (30分)

**見積の更新**:
- 有効期限が切れる見積の更新依頼
- 新規見積の登録

**案件マスタの更新**:
- 新規案件の追加
- 完了案件の整理

---

## 3. マスタデータ管理

### 3.1 発注先マスタの管理

#### 新規登録フロー

```
取引開始決定
  ↓
発注先情報の収集
  ├─ 会社名
  ├─ 住所
  ├─ 担当者
  ├─ 電話・メール
  └─ 支払条件
  ↓
発注先マスタに登録
  ├─ 発注先コード採番 (V + 3桁)
  ├─ 各項目を入力
  └─ 保存
  ↓
発注書作成で使用可能
```

#### 更新フロー

**定期更新** (四半期ごと):
- 住所変更
- 担当者変更
- 連絡先変更

**随時更新**:
- 支払条件の変更
- 取引停止

#### 発注先コード体系

```
V001 - V099:  部品メーカー
V100 - V199:  材料メーカー
V200 - V299:  商社
V300 - V399:  物流会社
V400 - V999:  その他
```

### 3.2 アイテムマスタの管理

#### 新規登録フロー

```
新商品の仕入決定
  ↓
アイテム情報の収集
  ├─ 商品名
  ├─ 仕様
  ├─ 単価
  ├─ 単位
  └─ 在庫管理区分
  ↓
アイテムマスタに登録
  ├─ アイテムコード採番 (A + 3桁)
  ├─ 各項目を入力
  └─ 保存
  ↓
発注書作成で使用可能
```

#### アイテムコード体系

```
A001 - A099:  機械部品
A100 - A199:  電気部品
A200 - A299:  材料
A300 - A399:  消耗品
A400 - A999:  その他
```

#### カテゴリ体系

```
- 機械部品
  - ネジ・ボルト
  - ベアリング
  - モーター
- 電気部品
  - コネクタ
  - ケーブル
  - センサー
- 材料
  - 金属材料
  - 樹脂材料
  - 塗料
```

### 3.3 案件マスタの管理

#### 新規登録フロー

```
新規案件の受注
  ↓
案件情報の確定
  ├─ 案件番号
  └─ 案件名
  ↓
案件マスタに登録
  ├─ body_id (案件番号) を入力
  ├─ body_name (案件名) を入力
  └─ 保存
  ↓
発注書作成で案件配分に使用可能
```

#### 案件番号体系

```
P001 - P099:  A製品関連
P100 - P199:  B製品関連
P200 - P299:  C製品関連
P300 - P399:  開発案件
P400 - P999:  その他
```

---

## 4. ERP連携フロー

### 4.1 データフロー全体像

```
┌────────────────────────────────────────────┐
│      kintone 発注管理システム              │
├────────────────────────────────────────────┤
│  発注書作成                                │
│   ├─ 基本情報入力                          │
│   ├─ 明細入力                              │
│   └─ 案件配分設定                          │
│        ↓                                   │
│  レコード保存                              │
│   ├─ po_items (発注明細)                   │
│   └─ erp_items (ERP用) 自動生成            │
└────────┬───────────────────────────────────┘
         │
         ▼ CSV出力
┌────────────────────────────────────────────┐
│           ERPシステム                      │
├────────────────────────────────────────────┤
│  CSV取込                                   │
│   ├─ 発注データ登録                        │
│   ├─ 案件別原価計上                        │
│   └─ 在庫引当                              │
└────────────────────────────────────────────┘
```

### 4.2 CSV出力フロー (今後実装予定)

#### ステップ1: 出力対象の選定 (5分)

**条件**:
- ステータスが「発注済み」
- ERP連携済みフラグが「未連携」
- 発注日が当日または過去

**フィルタ設定**:
```
ステータス = "発注済み" and
ERP連携済み = "未連携" and
発注日 <= "2026-02-14"
```

#### ステップ2: CSV出力 (5分)

1. 発注管理アプリの一覧画面
2. 上記フィルタを適用
3. 「その他の操作」→「ファイルへ書き出す」
4. **ERPテーブルのみ**を選択
5. CSV形式でエクスポート

#### ステップ3: CSV確認 (5分)

**チェック項目**:
- [ ] 文字化けがないか
- [ ] 案件配分が正しく展開されているか
- [ ] 数量・単価が正しいか
- [ ] アイテムコードが欠落していないか

**CSV形式例**:

```csv
アイテムコード,詳細項目,案件番号,数量,単価
A001,ステンレス製,P001,6,1000
A001,ステンレス製,P002,4,1000
A002,アルミ製,P001,10,500
```

#### ステップ4: ERP取込 (10分)

**ERPシステム側の操作**:
1. 発注データ取込メニューを開く
2. CSVファイルを選択
3. プレビューで内容確認
4. 取込実行
5. エラーがないか確認

#### ステップ5: 連携完了フラグ更新 (5分)

**kintone側の操作**:
1. 取込完了した発注書を開く
2. 「ERP連携済み」フィールドを「連携済み」に変更
3. 「ERP連携日」に取込日を入力
4. 保存

### 4.3 エラー対応

**よくあるエラー**:

| エラー内容 | 原因 | 対処法 |
|----------|------|-------|
| アイテムコード不明 | マスタ未登録 | アイテムマスタに登録 |
| 案件番号不明 | マスタ未登録 | 案件マスタに登録 |
| 数量が0 | 配分設定ミス | 発注書を修正 |
| 単価が0 | 入力漏れ | 発注書を修正 |
| 重複データ | 二重取込 | ERP側で削除 |

**エラー発生時の対応フロー**:

```
CSV取込エラー発生
  ↓
エラー内容の確認
  ├─ マスタ未登録 → マスタ登録
  ├─ データ不正 → 発注書修正
  └─ システムエラー → システム管理者に連絡
  ↓
修正後、再度CSV出力
  ↓
ERP再取込
  ↓
成功確認
```

---

## 5. エラー対応フロー

### 5.1 システムエラー対応

#### レベル1: ユーザー対応可能

**症状**: UIが崩れている、ボタンが押せない

**対処法**:
1. ブラウザキャッシュをクリア (Ctrl+Shift+R)
2. ブラウザを再起動
3. 別のブラウザで試す
4. 改善しない場合はシステム管理者に連絡

#### レベル2: システム管理者対応

**症状**: JavaScript エラーが発生する

**対処法**:
1. ブラウザコンソール (F12) でエラー内容を確認
2. エラーメッセージをメモ
3. 該当ファイルを確認
4. 必要に応じてファイルを差し替え
5. アプリを更新

#### レベル3: 開発者対応

**症状**: 機能が動作しない、データが正しく保存されない

**対処法**:
1. デバッグモードを有効化 (config.js)
2. ログを確認
3. ソースコードを確認
4. 修正・テスト
5. 本番環境に反映

### 5.2 データエラー対応

#### 案件配分の不整合

**症状**: 配分合計と明細数量が一致しない

**対処法**:
1. 該当レコードを開く
2. ERPテーブルの数量合計を確認
3. 不整合がある場合:
   - 発注書を複製
   - 正しい配分で再作成
   - 元の発注書を削除 (または無効化)

#### ERPテーブルが生成されていない

**症状**: erp_items テーブルが空

**対処法**:
1. ブラウザコンソールでエラーを確認
2. `erpBuilder.js` がアップロードされているか確認
3. ERPテーブルのフィールドが存在するか確認
4. レコードを再保存 (編集 → 保存)

---

## 6. データメンテナンス

### 6.1 定期クリーンアップ (月次)

#### 下書きレコードの整理

**対象**: 1ヶ月以上放置された下書き

**手順**:
1. フィルタ: ステータス = "下書き" and 作成日 < 30日前
2. 該当レコードを確認
3. 不要なレコードを削除
4. 必要なレコードは担当者に確認

#### 完了レコードのアーカイブ

**対象**: 1年以上前の完了レコード

**手順**:
1. フィルタ: ステータス = "完了" and 発注日 < 1年前
2. CSV出力でバックアップ
3. アーカイブ用アプリに移動 (または削除)

### 6.2 データ整合性チェック (四半期)

#### チェック項目

1. **発注明細とERPテーブルの整合性**
```javascript
// 各レコードで確認
po_items の数量合計 = erp_items の数量合計
```

2. **案件配分の整合性**
```javascript
// 案件配分ありの場合
po_items の数量 = 各案件の配分数量の合計
```

3. **金額計算の正確性**
```javascript
// 各レコードで確認
小計 = Σ(明細金額)
消費税 = 小計 × 税率
合計 = 小計 + 消費税
```

#### 不整合発見時の対応

1. 該当レコードをリスト化
2. 担当者に確認
3. 必要に応じて修正
4. 修正履歴を記録

---

## 📞 サポート連絡先

### 運用サポート

- **担当部署**: 購買管理部
- **内線**: [内線番号]
- **メール**: [メールアドレス]

### システムサポート

- **担当部署**: 情報システム部
- **内線**: [内線番号]
- **メール**: [メールアドレス]

### 緊急連絡先

- **24時間対応**: [電話番号]

---

## 📝 改訂履歴

| バージョン | 日付 | 変更内容 | 担当者 |
|-----------|------|---------|-------|
| 1.0 | 2026-02-14 | 初版作成 | - |

---

**© 2026 kintone 発注管理システム. All Rights Reserved.**
